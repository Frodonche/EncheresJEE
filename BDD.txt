Create database :
- name : encheres
- user : root
- pass : pass

-- CREATION DES TABLES -- 

-- Statut Promotions : (reduction (%) ou bon d'achat (euros))
create table statutpromotions(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    statut VARCHAR(30) NOT NULL,
    PRIMARY KEY (statut)
);

-- Promotions :
create table promotions(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    nom VARCHAR(30),
    code VARCHAR(30),
    statut VARCHAR(30) NOT NULL references statutpromotions(statut),
    nb INT, 
    PRIMARY KEY (id)
);

-- Users :
create table users(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    login VARCHAR(30),
    pass VARCHAR(30),
    nom VARCHAR(30),
    prenom VARCHAR(30),
    adresse VARCHAR(30),
    id_bancaire VARCHAR(30),
    connecte boolean,
    nb_abandon int,
    PRIMARY KEY (id)
);

-- Paniers :
create table paniers(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    id_users INT NOT NULL references users(id),
    id_promotions INT NOT NULL references promotions(id),
    total INT,
    nb_article INT,
    valide boolean,
    adresse_facturation VARCHAR(100),
    adresse_livraison VARCHAR(100),
    PRIMARY KEY (id)
);
-- Catégories :
create table categories(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    nom VARCHAR(30) UNIQUE,
    PRIMARY KEY (id)
);
-- Articles :
create table articles(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    id_sell_users INT NOT NULL references users(id),
    id_buy_users INT references users(id),
    nom VARCHAR(30),
    description VARCHAR(100),
    prix_init INT,
    date_fin date,
    prix_max INT,
    visible boolean,
    nom_categorie VARCHAR(30) NOT NULL references categories(nom),
    PRIMARY KEY (id)
);

-- Relation Paniers et Articles :
create table paniers_articles(
    idpaniers INT references paniers(id),
    idarticles INT references articles(id),
    PRIMARY KEY (idpaniers, idarticles)
);


-- PEUPLEMENT DES TABLES --

-- Statut Promotions : (reduction (%) ou bon d'achat (euros))
INSERT INTO statutpromotions (statut)
 VALUES
 ('reduction'),
 ('bonachat');

-- Promotions :
INSERT INTO promotions (nom, code, statut, nb)
 VALUES
 ('Bon de première utilisation !', '6CFT4', 'bonachat', 10),
 ('Réduc hiver, vive la fête !', '5DC48', 'reduction', 15);
 
 -- Users :
INSERT INTO users (login, pass, nom, prenom, adresse, id_bancaire, connecte, nb_abandon)
 VALUES
 ('Larma', 'pass', 'Weber', 'Laura', '1 rue du Pommier', 'RIBnum1', 0, 0),
 ('Iomide', 'pass', 'Maggioli', 'Steve', '2 rue du Pommier', 'RIBnum2', 0, 0),
 ('UnNainTernaute', 'pass', 'Roth', 'Guillaume', '3 rue du Pommier', 'RIBnum3', 0, 0),
 ('Ateact', 'pass', 'Dalati', 'Tarek', '4 rue du Pommier', 'RIBnum4', 0, 0);
 
-- Paniers :

-- No value, to generate by the application (?)


-- Catégories :
INSERT INTO categories (nom)
 VALUES
 ('Meubles'),
 ('Vêtements');
 

-- Articles :
INSERT INTO articles (id_sell_users, id_buy_users, nom, description, prix_init, date_fin, prix_max, visible, nom_categorie)
 VALUES
 (1, null, 'Vase de Birmanie', 'Vase de bourge pleins de dorures toussa', 10, '2019-03-01', null, 1, 'Meubles'),
 (1, null, 'Table de Birmanie', 'Une table chère', 20, '2019-03-01', null, 1, 'Meubles'),
 (2, null, 'Cadre de Birmanie', 'Véritable photo couleur de Marie-Antoinette fournie', 50, '2019-03-01', null, 1, 'Meubles');
 
 
 
 
