Create database :
- name : encheres
- user : root
- pass : pass

-- CREATION DES TABLES -- 

-- Statut Promotions : (reduction (%) ou bon d'achat (euros))
create table statutpromotions(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    statut VARCHAR(30) NOT NULL,
    PRIMARY KEY (statut)
);

-- Promotions :
create table promotions(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    nom VARCHAR(30),
    code VARCHAR(30),
    statut VARCHAR(30) NOT NULL references statutpromotions(statut),
    nb INT, 
    PRIMARY KEY (id)
);

-- Users :
create table users(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    login VARCHAR(30),
    pass VARCHAR(30),
    nom VARCHAR(30),
    prenom VARCHAR(30),
    adresse VARCHAR(30),
    id_bancaire VARCHAR(30),
    connecte boolean,
    nb_abandon int,
    PRIMARY KEY (id)
);

-- Paniers :
create table paniers(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    id_users INT NOT NULL references users(id),
    id_promotions INT NOT NULL references promotions(id),
    total INT,
    nb_article INT,
    valide boolean,
    adresse_facturation VARCHAR(100),
    adresse_livraison VARCHAR(100),
    PRIMARY KEY (id)
);

-- Articles :
create table articles(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    id_sell_users INT NOT NULL references users(id),
    id_buy_users INT references users(id),
    nom VARCHAR(30),
    description VARCHAR(100),
    prix_init INT,
    date_fin date,
    prix_max INT,
    visible boolean,
    PRIMARY KEY (id)
);

-- Relation Paniers et Articles :
create table paniers_articles(
    idpaniers INT references paniers(id),
    idarticles INT references articles(id),
    PRIMARY KEY (idpaniers, idarticles)
);

-- Catégories :
create table categories(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    nom VARCHAR(30),
    PRIMARY KEY (id)
);

-- Sous-Catégories :
create table souscategories(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    nom VARCHAR(30),
    PRIMARY KEY (id)
);

-- Relation Catégories et Sous-Catégories :
create table categories_souscategories(
    idcat INT references categories(id),
    idsscat INT references souscategories(id),
    PRIMARY KEY (idcat, idsscat)
);

-- Relation Articles et Catégories : (Ici la catégorie sera la sous-catégorie, j'me suis un peu trompée :)))
create table articles_sscategories(
    idarticles INT references articles(id),
    idcategories INT references souscategories(id),
    PRIMARY KEY (idarticles, idcategories)
);

-- PEUPLEMENT DES TABLES --

-- Statut Promotions : (reduction (%) ou bon d'achat (euros))
INSERT INTO statutpromotions (statut)
 VALUES
 ('reduction'),
 ('bonachat');

-- Promotions :
INSERT INTO promotions (nom, code, statut, nb)
 VALUES
 ('Bon de première utilisation !', '6CFT4', 'bonachat', 10),
 ('Réduc hiver, vive la fête !', '5DC48', 'reduction', 15);
 
 -- Users :
INSERT INTO users (login, pass, nom, prenom, adresse, id_bancaire, connecte, nb_abandon)
 VALUES
 ('Larma', 'pass', 'Weber', 'Laura', '1 rue du Pommier', 'RIBnum1', 'true', 0),
 ('Iomide', 'pass', 'Maggioli', 'Steve', '2 rue du Pommier', 'RIBnum2', 'true', 0),
 ('UnNainTernaute', 'pass', 'Roth', 'Guillaume', '3 rue du Pommier', 'RIBnum3', 'true', 0),
 ('Ateact', 'pass', 'Dalati', 'Tarek', '4 rue du Pommier', 'RIBnum4', 'true', 0);
 
-- Paniers :

-- No value, to generate by the application (?)

-- Articles :
INSERT INTO articles (id_sell_users, id_buy_users, nom, description, prix_init, date_fin, prix_max, visible)
 VALUES
 (1, null, 'Vase de Birmanie', 'Vase de bourge pleins de dorures toussa', 10, '2019-03-01', null, true),
 (1, null, 'Table de Birmanie', 'Une table chère', 20, '2019-03-01', null, true),
 (2, null, 'Cadre de Birmanie', 'Véritable photo couleur de Marie-Antoinette fournie', 50, '2019-03-01', null, true);
 
-- Catégories :
INSERT INTO categories (nom)
 VALUES
 ('Meubles'),
 ('Vêtements');
 
-- Sous-Catégories :
INSERT INTO souscategories (nom)
 VALUES
 ('Tables'),
 ('Cadres'),
 ('Vases'),
 ('Hommes'),
 ('Femmes');
 
-- Relation Catégories et Sous-Catégories :
INSERT INTO categories_souscategories (idcat, idsscat)
 VALUES
 (1, 1),
 (1, 2),
 (1, 3),
 (2, 4),
 (2, 5);
 
-- Relation Articles et Catégories : (Ici la catégorie sera la sous-catégorie, j'me suis un peu trompée :)))
INSERT INTO articles_sscategories (idarticles, idcategories)
 VALUES
 (1, 3),
 (2, 1),
 (3, 2);
 
 
 
 
